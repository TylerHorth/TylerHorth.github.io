<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="content-type" content="text/html; charset=utf-8">
        <title>Tyler Horth</title>
        <meta name="description" content="Personal website for Tyler Horth.">
        <link rel="stylesheet" href="main.css">
        <link href='https://fonts.googleapis.com/css?family=Lato:400,300' rel='stylesheet' type='text/css'>
        <script type="text/javascript">
            function fetchImage(url) {
                return new Promise((resolve, reject) => {
                    if (!url.match(/\.(jpg|png)$/)) {
                        reject(url);
                    } else {
                        fetch(url, { mode: 'no-cors' }).then((resp) => {
                            for (let elem of document.getElementsByClassName("bg")) {
                                elem.style.backgroundImage = `url('${url}')`
                            }
                            resolve(url)
                        }).catch(reject)
                    }
                })
            }

            fetch("https://www.reddit.com/r/EarthPorn/.json")
                .then((resp) => resp.json())
                .then((data) => {
                    let items = data.data.children
                    let randomIndex = Math.floor((Math.random()*items.length))
                    let url = items[randomIndex].data.url
                    const startIndex = randomIndex
                    let timeout = new Promise((resolve, reject) => {
                        setTimeout(reject, 500, 'request timed out');
                    })
                    Promise.race([timeout, fetchImage(url)]).then((url) => {
                        console.log(url)
                    }).catch((err) => {
                        console.log(`err: ${err}`)
                        console.log(`retrying...`)
                        randomIndex = (randomIndex + 1) % items.length
                        url = items[randomIndex].data.url
                        if (randomIndex != startIndex) {
                            fetchImage(url).then((url) => {
                                console.log(url)
                            })
                        }
                    })
                })
        </script>
    </head>
    <body>
        <div id="header"></div>
        <div id="content" class="bg">
            <div id="main">
                <div id="container">
                    <div id="name"><h1>TYLER</h1><h1>HORTH</h1></div>
                    <a id="github" class="link" href="https://github.com/TylerHorth">GitHub</a>
                    <a id="resume" class="link" href="./Resume.pdf">Resume</a>
                </div>
                <div id="blur-container">
                    <div class="bg" id="blur">
                    </div>
                </div>
            </div>
        </div>
        <div id="footer">
            <p>Images sourced from <a id="reddit" href="https://www.reddit.com/r/EarthPorn">/r/EarthPorn</a>.</p>
        </div>
    </body>
</html>
